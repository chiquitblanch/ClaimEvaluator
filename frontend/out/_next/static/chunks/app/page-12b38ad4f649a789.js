(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3265:(e,t,r)=>{"use strict";let a,n,i;r.d(t,{ClaimEvaluatorDemo:()=>ew});var s=r(5155),l=r(2115),o=r(4827),c=r(6037);let d="https://cdn.zama.org/relayer-sdk-js/0.3.0-5/relayer-sdk-js.umd.cjs";class u{isLoaded(){return p(window,this._trace)}load(){if(console.log("[RelayerSDKLoader] load..."),"relayerSDK"in window){if(!y(window.relayerSDK,this._trace))throw console.log("[RelayerSDKLoader] window.relayerSDK === undefined"),Error("RelayerSDKLoader: Unable to load FHEVM Relayer SDK");return Promise.resolve()}return new Promise((e,t)=>{if(document.querySelector('script[src="'.concat(d,'"]'))){p(window,this._trace)||t(Error("RelayerSDKLoader: window object does not contain a valid relayerSDK object.")),e();return}let r=document.createElement("script");r.src=d,r.type="text/javascript",r.async=!0,r.onload=()=>{p(window,this._trace)||(console.log("[RelayerSDKLoader] script onload FAILED..."),t(Error("RelayerSDKLoader: Relayer SDK script has been successfully loaded from ".concat(d,", however, the window.relayerSDK object is invalid.")))),e()},r.onerror=()=>{console.log("[RelayerSDKLoader] script onerror... "),t(Error("RelayerSDKLoader: Failed to load Relayer SDK from ".concat(d)))},console.log("[RelayerSDKLoader] add script to DOM..."),document.head.appendChild(r),console.log("[RelayerSDKLoader] script added!")})}constructor(e){this._trace=e.trace}}function y(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: relayerSDK is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: relayerSDK is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: relayerSDK is not an object"),!1):m(e,"initSDK","function",t)?m(e,"createInstance","function",t)?m(e,"SepoliaConfig","object",t)?!("__initialized__"in e)||!0===e.__initialized__||!1===e.__initialized__||(null==t||t("RelayerSDKLoader: relayerSDK.__initialized__ is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.createInstance is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.initSDK is invalid"),!1)}function p(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: window object is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: window object is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: window is not an object"),!1):"relayerSDK"in e?y(e.relayerSDK):(null==t||t("RelayerSDKLoader: window does not contain 'relayerSDK' property"),!1)}function m(e,t,r,a){if(!e||"object"!=typeof e)return!1;if(!(t in e))return null==a||a("RelayerSDKLoader: missing ".concat(String(t),".")),!1;let n=e[t];return null==n?(null==a||a("RelayerSDKLoader: ".concat(String(t)," is null or undefined.")),!1):typeof n===r||(null==a||a("RelayerSDKLoader: ".concat(String(t)," is not a ").concat(r,".")),!1)}let b=(e,t)=>t.some(t=>e instanceof t),h=new WeakMap,f=new WeakMap,g=new WeakMap,v={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return h.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return x(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function x(e){if(e instanceof IDBRequest){let t=new Promise((t,r)=>{let a=()=>{e.removeEventListener("success",n),e.removeEventListener("error",i)},n=()=>{t(x(e.result)),a()},i=()=>{r(e.error),a()};e.addEventListener("success",n),e.addEventListener("error",i)});return g.set(t,e),t}if(f.has(e))return f.get(e);let t=function(e){if("function"==typeof e)return(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(w(this),t),x(this.request)}:function(...t){return x(e.apply(w(this),t))};return(e instanceof IDBTransaction&&function(e){if(h.has(e))return;let t=new Promise((t,r)=>{let a=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",i),e.removeEventListener("abort",i)},n=()=>{t(),a()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",n),e.addEventListener("error",i),e.addEventListener("abort",i)});h.set(e,t)}(e),b(e,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,v):e}(e);return t!==e&&(f.set(e,t),g.set(t,e)),t}let w=e=>g.get(e),S=["get","getKey","getAll","getAllKeys","count"],D=["put","add","delete","clear"],j=new Map;function N(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(j.get(t))return j.get(t);let r=t.replace(/FromIndex$/,""),a=t!==r,n=D.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!(n||S.includes(r)))return;let i=async function(e,...t){let i=this.transaction(e,n?"readwrite":"readonly"),s=i.store;return a&&(s=s.index(t.shift())),(await Promise.all([s[r](...t),n&&i.done]))[0]};return j.set(t,i),i}v=(e=>({...e,get:(t,r,a)=>N(t,r)||e.get(t,r,a),has:(t,r)=>!!N(t,r)||e.has(t,r)}))(v);let E=["continue","continuePrimaryKey","advance"],K={},C=new WeakMap,I=new WeakMap,_={get(e,t){if(!E.includes(t))return e[t];let r=K[t];return r||(r=K[t]=function(...e){C.set(this,I.get(this)[t](...e))}),r}};async function*k(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;let r=new Proxy(t,_);for(I.set(r,t),g.set(r,w(t));t;)yield r,t=await (C.get(r)||t.continue()),C.delete(r)}function P(e,t){return t===Symbol.asyncIterator&&b(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&b(e,[IDBIndex,IDBObjectStore])}async function A(){return i||(i=function(e,t,{blocked:r,upgrade:a,blocking:n,terminated:i}={}){let s=indexedDB.open(e,1),l=x(s);return a&&s.addEventListener("upgradeneeded",e=>{a(x(s.result),e.oldVersion,e.newVersion,x(s.transaction),e)}),r&&s.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),l.then(e=>{i&&e.addEventListener("close",()=>i()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),l}("fhevm",0,{upgrade(e){e.objectStoreNames.contains("paramsStore")||e.createObjectStore("paramsStore",{keyPath:"acl"}),e.objectStoreNames.contains("publicKeyStore")||e.createObjectStore("publicKeyStore",{keyPath:"acl"})}}))}function R(e){if("object"!=typeof e)throw Error("FhevmStoredPublicKey must be an object");if(null!==e){if(!("publicKeyId"in e))throw Error("FhevmStoredPublicKey.publicKeyId does not exist");if("string"!=typeof e.publicKeyId)throw Error("FhevmStoredPublicKey.publicKeyId must be a string");if(!("publicKey"in e))throw Error("FhevmStoredPublicKey.publicKey does not exist");if(!(e.publicKey instanceof Uint8Array))throw Error("FhevmStoredPublicKey.publicKey must be a Uint8Array")}}function L(e){if("object"!=typeof e)throw Error("FhevmStoredPublicParams must be an object");if(null!==e){if(!("publicParamsId"in e))throw Error("FhevmStoredPublicParams.publicParamsId does not exist");if("string"!=typeof e.publicParamsId)throw Error("FhevmStoredPublicParams.publicParamsId must be a string");if(!("publicParams"in e))throw Error("FhevmStoredPublicParams.publicParams does not exist");if(!(e.publicParams instanceof Uint8Array))throw Error("FhevmStoredPublicParams.publicParams must be a Uint8Array")}}async function M(e){let t,r=await A();if(!r)return{publicParams:null};let a=null;try{let t=await r.get("publicKeyStore",e);(null==t?void 0:t.value)&&(R(t.value),a=t.value)}catch(e){}let n=null;try{let t=await r.get("paramsStore",e);(null==t?void 0:t.value)&&(L(t.value),n=t.value)}catch(e){}let i=null==a?void 0:a.publicKey,s=null==a?void 0:a.publicKeyId,l=n?{2048:n}:null;return s&&i&&(t={id:s,data:i}),{...void 0!==t&&{publicKey:t},publicParams:l}}async function T(e,t,r){R(t),L(r);let a=await A();a&&(t&&await a.put("publicKeyStore",{acl:e,value:t}),r&&await a.put("paramsStore",{acl:e,value:r}))}v=(e=>({...e,get:(t,r,a)=>P(t,r)?k:e.get(t,r,a),has:(t,r)=>P(t,r)||e.has(t,r)}))(v);class F extends Error{constructor(e,t,r){super(t,r),this.code=e,this.name="FhevmReactError"}}function W(e,t,r){throw new F(e,t,r?{cause:r}:void 0)}let V=async e=>{if(!p(window,console.log))throw Error("window.relayerSDK is not available");let t=await window.relayerSDK.initSDK(e);if(window.relayerSDK.__initialized__=t,!t)throw Error("window.relayerSDK.initSDK failed.");return!0};class B extends Error{constructor(e="FHEVM operation was cancelled"){super(e),this.name="FhevmAbortError"}}async function H(e){if("string"==typeof e){let t=new c.FR(e);return Number((await t.getNetwork()).chainId)}return Number.parseInt(await e.request({method:"eth_chainId"}),16)}async function O(e){let t=new c.FR(e);try{return await t.send("web3_clientVersion",[])}catch(t){W("WEB3_CLIENTVERSION_ERROR","The URL ".concat(e," is not a Web3 node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function U(e){let t=await O(e);if("string"==typeof t&&t.toLowerCase().includes("hardhat"))try{let t=await z(e);if(!t||"object"!=typeof t||!("ACLAddress"in t&&"string"==typeof t.ACLAddress&&t.ACLAddress.startsWith("0x"))||!("InputVerifierAddress"in t&&"string"==typeof t.InputVerifierAddress&&t.InputVerifierAddress.startsWith("0x"))||!("KMSVerifierAddress"in t&&"string"==typeof t.KMSVerifierAddress&&t.KMSVerifierAddress.startsWith("0x")))return;return t}catch(e){return}}async function z(e){let t=new c.FR(e);try{return await t.send("fhevm_relayer_metadata",[])}catch(t){W("FHEVM_RELAYER_METADATA_ERROR","The URL ".concat(e," is not a FHEVM Hardhat node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function q(e,t){let r=await H(e),a="string"==typeof e?e:void 0,n={31337:"http://localhost:8545",...null!=t?t:{}};return Object.hasOwn(n,r)?(a||(a=n[r]),{isMock:!0,chainId:r,rpcUrl:a}):{isMock:!1,chainId:r,rpcUrl:a}}let G=async e=>{let t=()=>{if(n.aborted)throw new B},a=e=>{i&&i(e)},{signal:n,onStatusChange:i,provider:s,mockChains:l}=e,{isMock:c,rpcUrl:d,chainId:y}=await q(s,l);if(c){let e=await U(d);if(e){a("creating");let n=await Promise.all([r.e(224),r.e(79)]).then(r.bind(r,7079)),i=await n.fhevmMockCreateInstance({rpcUrl:d,chainId:y,metadata:e});return t(),i}}t(),p(window,console.log)||(a("sdk-loading"),await new u({trace:console.log}).load(),t(),a("sdk-loaded")),p(window,console.log)&&!0===window.relayerSDK.__initialized__||(a("sdk-initializing"),await V(),t(),a("sdk-initialized"));let m=window.relayerSDK,b=m.SepoliaConfig.aclContractAddress;if(!function(e){return"string"==typeof e&&!!(0,o.PW)(e)}(b))throw Error("Invalid address: ".concat(b));let h=await M(b);t();let f={...m.SepoliaConfig,network:s,publicKey:h.publicKey,publicParams:h.publicParams};a("creating");let g=await m.createInstance(f);return await T(b,g.getPublicKey(),g.getPublicParams(2048)),t(),g};function J(e,t){if(!e){let e=t?"Assertion failed: ".concat(t):"Assertion failed.";throw console.error(e),Error(e)}}var Z=r(8814),Y=r(557),$=r(2127),Q=r(3338),X=r(9353),ee=r(7325),et=r(5777),er=r(5378),ea=r(2507);function en(){return Math.floor(Date.now()/1e3)}var ei=new WeakMap,es=new WeakMap,el=new WeakMap,eo=new WeakMap;class ec{get contractAddresses(){return(0,ee._)(this,ei)}get userAddress(){return(0,ee._)(this,es)}get publicKey(){return(0,ee._)(this,el)}get key(){return(0,ee._)(this,eo)}constructor(e,t,r,a){if((0,et._)(this,ei,{writable:!0,value:void 0}),(0,et._)(this,es,{writable:!0,value:void 0}),(0,et._)(this,el,{writable:!0,value:void 0}),(0,et._)(this,eo,{writable:!0,value:void 0}),!o.PW(r))throw TypeError("Invalid address ".concat(r));let n=t.sort(),i=e.createEIP712(null!=a?a:$.j,n,0,0);try{let e=ea.z.hash(i.domain,{UserDecryptRequestVerification:i.types.UserDecryptRequestVerification},i.message);(0,er._)(this,ei,n),(0,er._)(this,es,r),(0,er._)(this,eo,"".concat(r,":").concat(e))}catch(e){throw console.log(e),e}}}var ed=new WeakMap,eu=new WeakMap,ey=new WeakMap,ep=new WeakMap,em=new WeakMap,eb=new WeakMap,eh=new WeakMap,ef=new WeakMap;class eg{get privateKey(){return(0,ee._)(this,eu)}get publicKey(){return(0,ee._)(this,ed)}get signature(){return(0,ee._)(this,ey)}get contractAddresses(){return(0,ee._)(this,eh)}get startTimestamp(){return(0,ee._)(this,ep)}get durationDays(){return(0,ee._)(this,em)}get userAddress(){return(0,ee._)(this,eb)}static checkIs(e){if(!e||"object"!=typeof e||!("publicKey"in e&&"string"==typeof e.publicKey)||!("privateKey"in e&&"string"==typeof e.privateKey)||!("signature"in e&&"string"==typeof e.signature)||!("startTimestamp"in e&&"number"==typeof e.startTimestamp)||!("durationDays"in e&&"number"==typeof e.durationDays)||!("contractAddresses"in e&&Array.isArray(e.contractAddresses)))return!1;for(let t=0;t<e.contractAddresses.length;++t)if("string"!=typeof e.contractAddresses[t]||!e.contractAddresses[t].startsWith("0x"))return!1;return!!("userAddress"in e&&"string"==typeof e.userAddress&&e.userAddress.startsWith("0x"))&&!!("eip712"in e&&"object"==typeof e.eip712&&null!==e.eip712)&&!!("domain"in e.eip712&&"object"==typeof e.eip712.domain)&&!!("primaryType"in e.eip712&&"string"==typeof e.eip712.primaryType)&&"message"in e.eip712&&!!("types"in e.eip712&&"object"==typeof e.eip712.types&&null!==e.eip712.types)}toJSON(){return{publicKey:(0,ee._)(this,ed),privateKey:(0,ee._)(this,eu),signature:(0,ee._)(this,ey),startTimestamp:(0,ee._)(this,ep),durationDays:(0,ee._)(this,em),userAddress:(0,ee._)(this,eb),contractAddresses:(0,ee._)(this,eh),eip712:(0,ee._)(this,ef)}}static fromJSON(e){return new eg("string"==typeof e?JSON.parse(e):e)}equals(e){return e.signature===(0,ee._)(this,ey)}isValid(){return en()<(0,ee._)(this,ep)+24*(0,ee._)(this,em)*3600}async saveToGenericStringStorage(e,t,r){try{let a=JSON.stringify(this),n=new ec(t,(0,ee._)(this,eh),(0,ee._)(this,eb),r?(0,ee._)(this,ed):void 0);await e.setItem(n.key,a),console.log("signature saved! contracts=".concat((0,ee._)(this,eh).length))}catch(e){console.error("FhevmDecryptionSignature.saveToGenericStringStorage() failed!")}}static async loadFromGenericStringStorage(e,t,r,a,n){try{let i=new ec(t,r,a,n),s=await e.getItem(i.key);if(!s)return console.warn("Could not load signature! key=".concat(i.key)),null;try{let e=eg.fromJSON(s);if(!e.isValid())return null;return e}catch(e){return null}}catch(e){return console.error("FhevmDecryptionSignature.loadFromGenericStringStorage() failed!"),null}}static async new(e,t,r,a,n){try{let i=await n.getAddress(),s=en(),l=e.createEIP712(r,t,s,365),o=await n.signTypedData(l.domain,{UserDecryptRequestVerification:l.types.UserDecryptRequestVerification},l.message);return new eg({publicKey:r,privateKey:a,contractAddresses:t,startTimestamp:s,durationDays:365,signature:o,eip712:l,userAddress:i})}catch(e){return null}}static async loadOrSign(e,t,r,a,n){let i=await r.getAddress(),s=await eg.loadFromGenericStringStorage(a,e,t,i,null==n?void 0:n.publicKey);if(s)return s;let{publicKey:l,privateKey:o}=null!=n?n:e.generateKeypair(),c=await eg.new(e,t,l,o,r);return c?(await c.saveToGenericStringStorage(a,e,!!(null==n?void 0:n.publicKey)),c):null}constructor(e){if((0,et._)(this,ed,{writable:!0,value:void 0}),(0,et._)(this,eu,{writable:!0,value:void 0}),(0,et._)(this,ey,{writable:!0,value:void 0}),(0,et._)(this,ep,{writable:!0,value:void 0}),(0,et._)(this,em,{writable:!0,value:void 0}),(0,et._)(this,eb,{writable:!0,value:void 0}),(0,et._)(this,eh,{writable:!0,value:void 0}),(0,et._)(this,ef,{writable:!0,value:void 0}),!eg.checkIs(e))throw TypeError("Invalid FhevmDecryptionSignatureType");(0,er._)(this,ed,e.publicKey),(0,er._)(this,eu,e.privateKey),(0,er._)(this,ey,e.signature),(0,er._)(this,ep,e.startTimestamp),(0,er._)(this,em,e.durationDays),(0,er._)(this,eb,e.userAddress),(0,er._)(this,eh,e.contractAddresses),(0,er._)(this,ef,e.eip712)}}let ev={0xaa36a7:{address:"0x8750236AA4B2737b89E8E5b6AE881852376181D7",chainId:0xaa36a7,chainName:"sepolia"}},ex={abi:[{inputs:[],name:"ZamaProtocolUnsupported",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"claimId",type:"uint256"}],name:"ClaimEvaluated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"claimId",type:"uint256"},{indexed:!0,internalType:"address",name:"claimant",type:"address"}],name:"ClaimSubmitted",type:"event"},{inputs:[{internalType:"uint256",name:"claimId",type:"uint256"}],name:"claimExists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"confidentialProtocolId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"claimId",type:"uint256"}],name:"evaluateClaim",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"claimId",type:"uint256"}],name:"getClaim",outputs:[{internalType:"euint32",name:"lossAmount",type:"bytes32"},{internalType:"euint32",name:"riskLevel",type:"bytes32"},{internalType:"euint32",name:"payout",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"getClaimCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"claimId",type:"uint256"}],name:"getLossAmount",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"claimId",type:"uint256"}],name:"getPayout",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"claimId",type:"uint256"}],name:"getRiskLevel",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"externalEuint32",name:"lossAmountEuint32",type:"bytes32"},{internalType:"externalEuint32",name:"riskLevelEuint32",type:"bytes32"},{internalType:"bytes",name:"inputProof",type:"bytes"}],name:"submitClaim",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"}]},ew=()=>{var e,t,r,a;let{storage:n}=(0,Z.p)(),{provider:i,chainId:o,accounts:c,isConnected:d,connect:u,ethersSigner:y,ethersReadonlyProvider:p,sameChain:m,sameSigner:b,initialMockChains:h}=(0,Y.z)(),{instance:f,status:g,error:v}=function(e){let{provider:t,chainId:r,initialMockChains:a,enabled:n=!0}=e,[i,s]=(0,l.useState)(void 0),[o,c]=(0,l.useState)("idle"),[d,u]=(0,l.useState)(void 0),[y,p]=(0,l.useState)(n),[m,b]=(0,l.useState)(0),h=(0,l.useRef)(null),f=(0,l.useRef)(t),g=(0,l.useRef)(r),v=(0,l.useRef)(a),x=(0,l.useCallback)(()=>{h.current&&(f.current=void 0,g.current=void 0,h.current.abort(),h.current=null),f.current=t,g.current=r,s(void 0),u(void 0),c("idle"),void 0!==t&&b(e=>e+1)},[t,r]);return(0,l.useEffect)(()=>{x()},[x]),(0,l.useEffect)(()=>{p(n)},[n]),(0,l.useEffect)(()=>{if(!1===y){console.log("cancelled"),h.current&&(h.current.abort(),h.current=null),s(void 0),u(void 0),c("idle");return}if(!0===y){if(void 0===f.current){s(void 0),u(void 0),c("idle");return}h.current||(h.current=new AbortController),J(!h.current.signal.aborted,"!controllerRef.current.signal.aborted"),c("loading"),u(void 0);let e=h.current.signal,t=f.current;G({signal:e,provider:t,mockChains:v.current,onStatusChange:e=>console.log("[useFhevm] createFhevmInstance status changed: ".concat(e))}).then(r=>{console.log("[useFhevm] createFhevmInstance created!"),e.aborted||(J(t===f.current,"thisProvider === _providerRef.current"),s(r),u(void 0),c("ready"))}).catch(r=>{console.log("Error Was thrown !!! error... "+r.name),e.aborted||(J(t===f.current,"thisProvider === _providerRef.current"),s(void 0),u(r),c("error"))})}},[y,m]),{instance:i,refresh:x,error:d,status:o}}({provider:i,chainId:o,initialMockChains:h,enabled:!0}),x=(e=>{let{instance:t,fhevmDecryptionSignatureStorage:r,chainId:a,ethersSigner:n,ethersReadonlyProvider:i,sameChain:s,sameSigner:o}=e,[c,d]=(0,l.useState)(void 0),[u,y]=(0,l.useState)(void 0),[p,m]=(0,l.useState)(void 0),[b,h]=(0,l.useState)(void 0),[f,g]=(0,l.useState)(void 0),[v,x]=(0,l.useState)(void 0),[w,S]=(0,l.useState)(void 0),[D,j]=(0,l.useState)(!1),[N,E]=(0,l.useState)(!1),[K,C]=(0,l.useState)(!1),[I,_]=(0,l.useState)(!1),[k,P]=(0,l.useState)(""),A=(0,l.useRef)(void 0),R=(0,l.useRef)(!1),L=(0,l.useRef)(!1),M=(0,l.useRef)(!1),T=(0,l.useRef)(!1),F=(0,l.useMemo)(()=>{let e=function(e){var t;if(!e)return{abi:ex.abi};let r=ev[e.toString()];return"address"in r&&r.address!==$.j?{address:null==r?void 0:r.address,chainId:null!=(t=null==r?void 0:r.chainId)?t:e,chainName:null==r?void 0:r.chainName,abi:ex.abi}:{abi:ex.abi,chainId:e}}(a);return A.current=e,void 0===a||e.address?(void 0===a||e.address)&&P(""):P("ClaimEvaluator deployment not found for chainId=".concat(a,".")),e},[a]),W=(0,l.useMemo)(()=>{if(F&&void 0!==a)return!!F.address&&F.address!==$.j},[F,a]),V=(0,l.useMemo)(()=>F.address&&t&&n&&!D&&!N,[F.address,t,n,D,N]),B=(0,l.useCallback)((e,r)=>{if(R.current||L.current||!F.address||!t||!n)return;if(r<1||r>3)return void P("Risk level must be between 1 (Low) and 3 (High)");let i=F.address;R.current=!0,j(!0),P("Starting claim submission..."),(async()=>{await new Promise(e=>setTimeout(e,100));let l=()=>{var e;return i!==(null==(e=A.current)?void 0:e.address)||!s.current(a)||!o.current(n)};try{let a=t.createEncryptedInput(i,n.address);a.add32(e),a.add32(r),P("Encrypting claim data...");let s=await a.encrypt();if(l())return void P("Ignore claim submission");P("Submitting claim to contract...");let o=new Q.NZ(i,F.abi,n),u=await o.submitClaim(s.handles[0],s.handles[1],s.inputProof);P("Waiting for tx: ".concat(u.hash,"..."));let y=await u.wait();if(l())return void P("Ignore claim submission");let p=null==y?void 0:y.logs.find(e=>{try{let t=o.interface.parseLog(e);return(null==t?void 0:t.name)==="ClaimSubmitted"}catch(e){return!1}});if(p){let e=o.interface.parseLog(p),t=null==e?void 0:e.args[0];d(Number(t)),P("Claim submitted successfully! Claim ID: ".concat(t))}else P("Claim submitted but could not retrieve claim ID");void 0!==c&&z()}catch(e){P("Claim submission failed: ".concat(e instanceof Error?e.message:String(e)))}finally{R.current=!1,j(!1)}})()},[n,F.address,F.abi,t,a,s,o,c]),H=(0,l.useMemo)(()=>F.address&&t&&n&&void 0!==c&&!D&&!N,[F.address,t,n,c,D,N]),O=(0,l.useCallback)(()=>{if(R.current||L.current||!F.address||!t||!n||void 0===c)return;let e=F.address;L.current=!0,E(!0),P("Evaluating claim..."),(async()=>{try{let t=new Q.NZ(e,F.abi,n);P("Calling evaluateClaim for claim ID ".concat(c,"..."));let r=await t.evaluateClaim(c);P("Waiting for tx: ".concat(r.hash,"..."));let i=await r.wait();if((()=>{var t;return e!==(null==(t=A.current)?void 0:t.address)||!s.current(a)||!o.current(n)})())return void P("Ignore claim evaluation");P("Claim evaluated successfully! Status: ".concat(null==i?void 0:i.status)),z()}catch(e){P("Claim evaluation failed: ".concat(e instanceof Error?e.message:String(e)))}finally{L.current=!1,E(!1)}})()},[n,F.address,F.abi,t,a,c,s,o]),U=(0,l.useMemo)(()=>F.address&&i&&!I&&void 0!==c,[F.address,i,I,c]),z=(0,l.useCallback)(()=>{var e,t;if(T.current||!A.current||!(null==(e=A.current)?void 0:e.chainId)||!(null==(t=A.current)?void 0:t.address)||!i||void 0===c)return;T.current=!0,_(!0);let r=A.current.chainId,a=A.current.address,n=new Q.NZ(a,A.current.abi,i);Promise.all([n.getLossAmount(c),n.getRiskLevel(c),n.getPayout(c)]).then(e=>{var t;let[n,i,l]=e;s.current(r)&&a===(null==(t=A.current)?void 0:t.address)&&c==c&&(y(n),m(i),h(l)),T.current=!1,_(!1)}).catch(e=>{P("Failed to refresh claim data: ".concat(e instanceof Error?e.message:String(e))),T.current=!1,_(!1)})},[i,s,c]);(0,l.useEffect)(()=>{void 0!==c&&z()},[c,z]);let q=(0,l.useMemo)(()=>F.address&&t&&n&&!I&&!K&&b&&b!==X.p&&b!==(null==w?void 0:w.handle),[F.address,t,n,I,K,b,w]),G=(0,l.useCallback)(()=>{if(T.current||M.current||!F.address||!t||!n||b===(null==w?void 0:w.handle))return;if(!b||b===X.p)return void S(void 0);let e=F.address;M.current=!0,C(!0),P("Starting decryption..."),(async()=>{let i=()=>{var t;return e!==(null==(t=A.current)?void 0:t.address)||!s.current(a)||!o.current(n)};try{let a=await eg.loadOrSign(t,[F.address],n,r);if(!a)return void P("Unable to build FHEVM decryption signature");if(i())return void P("Ignore FHEVM decryption");P("Decrypting payout...");let s=await t.userDecrypt([{handle:b,contractAddress:e}],a.privateKey,a.publicKey,a.signature,a.contractAddresses,a.userAddress,a.startTimestamp,a.durationDays);if(P("Decryption completed!"),i())return void P("Ignore FHEVM decryption");S({handle:b,clear:s[b]}),P("Payout amount: ".concat(s[b]))}finally{M.current=!1,C(!1)}})()},[r,n,F.address,t,b,a,s,o,w]);return{contractAddress:F.address,isDeployed:W,canSubmitClaim:V,canEvaluateClaim:H,canRefresh:U,canDecryptPayout:q,submitClaim:B,evaluateClaim:O,refreshClaimData:z,decryptPayout:G,currentClaimId:c,lossAmountHandle:u,riskLevelHandle:p,payoutHandle:b,clearPayout:null==w?void 0:w.clear,isSubmitting:D,isEvaluating:N,isRefreshing:I,isDecrypting:K,message:k}})({instance:f,fhevmDecryptionSignatureStorage:n,eip1193Provider:i,chainId:o,ethersSigner:y,ethersReadonlyProvider:p,sameChain:m,sameSigner:b}),[w,S]=(0,l.useState)("0.01"),[D,j]=(0,l.useState)("1"),N="inline-flex items-center justify-center rounded-lg bg-yellow-500 px-6 py-3 font-bold text-black transition-all duration-200 hover:bg-yellow-400 active:bg-yellow-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-yellow-500 focus-visible:ring-offset-2 focus-visible:ring-offset-black disabled:opacity-40 disabled:cursor-not-allowed shadow-lg",E="inline-flex items-center justify-center rounded-lg bg-green-600 px-6 py-3 font-bold text-white transition-all duration-200 hover:bg-green-500 active:bg-green-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-green-500 focus-visible:ring-offset-2 focus-visible:ring-offset-black disabled:opacity-40 disabled:cursor-not-allowed shadow-lg";return d?!1===x.isDeployed?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen p-4",children:(0,s.jsx)("div",{className:"max-w-2xl w-full card-bg p-8 rounded-xl border-2 border-yellow-500",children:(0,s.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,s.jsx)("div",{className:"text-4xl",children:"⚠️"}),(0,s.jsxs)("div",{className:"flex-1 space-y-3",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-yellow-500",children:"Contract Not Deployed"}),(0,s.jsxs)("p",{className:"text-gray-300 text-lg",children:["The ClaimEvaluator contract is not available on the current network (Chain ID: ",o,")"]}),(0,s.jsx)("div",{className:"card-bg p-4 rounded-lg border border-gray-700",children:(0,s.jsx)("p",{className:"text-sm text-gray-400 font-mono",children:"npm run deploy:localhost"})}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"Please deploy the contract first and then refresh the page."})]})]})})}):(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8 space-y-6",children:[(0,s.jsx)("div",{className:"card-bg rounded-2xl p-8 border-2 border-yellow-500",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-yellow-500 mb-2",children:"⚡ Claim Evaluator"}),(0,s.jsx)("p",{className:"text-gray-400 text-lg",children:"Private Insurance Claim Processing with FHE"})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)("div",{className:"inline-block bg-green-600 text-white px-4 py-2 rounded-lg font-bold",children:"Connected"})})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"card-bg rounded-xl p-6 space-y-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-yellow-500 mb-4",children:"\uD83C\uDF10 Network Information"}),(0,s.jsx)(eD,{label:"Chain ID",value:o}),(0,s.jsx)(eD,{label:"Wallet Address",value:y?eS(y.address):"Not connected",mono:!0})]}),(0,s.jsxs)("div",{className:"card-bg rounded-xl p-6 space-y-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-yellow-500 mb-4",children:"\uD83D\uDCDC Contract Status"}),(0,s.jsx)(eD,{label:"Contract Address",value:eS(x.contractAddress||""),mono:!0}),(0,s.jsx)(eD,{label:"Deployment Status",value:x.isDeployed})]})]}),(0,s.jsxs)("div",{className:"card-bg rounded-xl p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-green-500 mb-4",children:"\uD83D\uDD10 FHEVM Encryption Status"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsx)(eD,{label:"Instance",value:f?"Initialized":"Not available"}),(0,s.jsx)(eD,{label:"Status",value:g}),(0,s.jsx)(eD,{label:"Error",value:null!=v?v:"No errors",type:v?"error":"success"})]})]}),(0,s.jsxs)("div",{className:"card-bg rounded-xl p-6 border-2 border-green-600",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-green-500 mb-6",children:"\uD83D\uDCDD Submit New Claim"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-gray-300 font-bold text-lg",children:"\uD83D\uDCB0 Loss Amount (ETH)"}),(0,s.jsx)("input",{type:"number",step:"0.001",min:"0",className:"w-full bg-black border-2 border-gray-700 rounded-lg px-4 py-3 text-white text-lg focus:border-yellow-500 focus:outline-none transition-colors",value:w,onChange:e=>S(e.target.value),disabled:!x.canSubmitClaim,placeholder:"0.01"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Maximum: 4.29 ETH"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-gray-300 font-bold text-lg",children:"⚠️ Risk Level"}),(0,s.jsxs)("select",{className:"w-full bg-black border-2 border-gray-700 rounded-lg px-4 py-3 text-white text-lg focus:border-yellow-500 focus:outline-none transition-colors",value:D,onChange:e=>j(e.target.value),disabled:!x.canSubmitClaim,children:[(0,s.jsx)("option",{value:"1",children:"1 - Low Risk"}),(0,s.jsx)("option",{value:"2",children:"2 - Medium Risk"}),(0,s.jsx)("option",{value:"3",children:"3 - High Risk"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Select the risk assessment level"})]})]}),(0,s.jsx)("button",{className:N+" w-full text-lg",disabled:!x.canSubmitClaim,onClick:()=>{let e=parseFloat(w),t=parseInt(D,10);if(!isNaN(e)&&!isNaN(t)&&e>=0)try{let r=Math.floor(1e9*e);if(r>0xffffffff)return;x.submitClaim(r,t)}catch(e){console.error("Failed to parse loss amount:",e)}},children:x.canSubmitClaim?"\uD83D\uDE80 Submit Claim":x.isSubmitting?"⏳ Submitting...":"❌ Cannot Submit"})]}),void 0!==x.currentClaimId&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"card-bg rounded-xl p-6 border-2 border-yellow-500",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-yellow-500 mb-6",children:"\uD83D\uDD12 Encrypted Claim Data"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(eD,{label:"Claim ID",value:x.currentClaimId,highlight:!0}),(0,s.jsx)(eD,{label:"Loss Amount Handle",value:null!=(e=x.lossAmountHandle)?e:"Not loaded",mono:!0}),(0,s.jsx)(eD,{label:"Risk Level Handle",value:null!=(t=x.riskLevelHandle)?t:"Not loaded",mono:!0}),(0,s.jsx)(eD,{label:"Payout Handle",value:null!=(r=x.payoutHandle)?r:"Not loaded",mono:!0})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsx)("button",{className:E+" text-lg",disabled:!x.canEvaluateClaim,onClick:x.evaluateClaim,children:x.canEvaluateClaim?"⚙️ Evaluate Claim":x.isEvaluating?"⏳ Evaluating...":"❌ Cannot Evaluate"}),(0,s.jsx)("button",{className:E+" text-lg",disabled:!x.canRefresh,onClick:x.refreshClaimData,children:x.canRefresh?"\uD83D\uDD04 Refresh Data":"❌ Cannot Refresh"})]}),(0,s.jsxs)("div",{className:"card-bg rounded-xl p-6 border-2 border-green-600",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-green-500 mb-6",children:"\uD83D\uDD13 Decrypt Payout"}),(0,s.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,s.jsx)(eD,{label:"Payout Handle",value:null!=(a=x.payoutHandle)?a:"Waiting for evaluation",mono:!0}),void 0!==x.clearPayout&&(0,s.jsxs)("div",{className:"bg-green-900 border-2 border-green-500 rounded-lg p-6",children:[(0,s.jsx)("p",{className:"text-sm text-green-300 mb-2",children:"Decrypted Payout Amount"}),(0,s.jsxs)("p",{className:"text-4xl font-bold text-green-400",children:[(Number(x.clearPayout)/1e9).toFixed(9)," ETH"]}),(0,s.jsxs)("p",{className:"text-sm text-green-300 mt-2",children:["(",String(x.clearPayout)," gwei)"]})]})]}),(0,s.jsx)("button",{className:N+" w-full text-lg",disabled:!x.canDecryptPayout,onClick:x.decryptPayout,children:x.canDecryptPayout?"\uD83D\uDD13 Decrypt Payout":x.isDecrypting?"⏳ Decrypting...":void 0!==x.clearPayout?"✅ Already Decrypted":"❌ Nothing to Decrypt"})]})]}),x.message&&(0,s.jsx)("div",{className:"card-bg rounded-xl p-6 border-2 border-yellow-500",children:(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("div",{className:"text-2xl",children:"\uD83D\uDCAC"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-yellow-500 mb-2",children:"System Message"}),(0,s.jsx)("p",{className:"text-gray-300",children:x.message})]})]})})]}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h1",{className:"text-5xl font-bold text-yellow-500",children:"⚡ Claim Evaluator"}),(0,s.jsx)("p",{className:"text-xl text-gray-400",children:"Private Insurance Claim Processing"})]}),(0,s.jsxs)("div",{className:"card-bg p-8 rounded-xl space-y-4",children:[(0,s.jsx)("p",{className:"text-gray-300 text-lg",children:"Connect your wallet to get started"}),(0,s.jsx)("button",{className:N+" text-xl px-8 py-4",disabled:d,onClick:u,children:"\uD83E\uDD8A Connect MetaMask"})]})]})})};function eS(e){return!e||e.length<10?e:"".concat(e.slice(0,6),"...").concat(e.slice(-4))}function eD(e){let t,{label:r,value:a,mono:n=!1,highlight:i=!1,type:l="default"}=e,o=!1,c=!1;return"boolean"==typeof a?(o=!0,c=a,t=a?"true":"false"):t="string"==typeof a||"number"==typeof a||"bigint"==typeof a?String(a):null===a?"null":void 0===a?"undefined":a instanceof Error?a.message:JSON.stringify(a),(0,s.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,s.jsx)("span",{className:"text-sm text-gray-400 font-semibold",children:r}),(0,s.jsx)("span",{className:"\n          ".concat(o?c?"text-green-400":"text-red-400":"success"===l?"text-green-400":"error"===l?"text-red-400":i?"text-yellow-400":"text-gray-300"," \n          ").concat(n?"font-mono text-xs":"font-semibold"," \n          ").concat(o?c?"bg-green-900":"bg-red-900":"bg-black","\n          px-3 py-2 rounded-lg border border-gray-700\n          break-all\n        "),children:t})]})}},9608:(e,t,r)=>{Promise.resolve().then(r.bind(r,3265))}},e=>{e.O(0,[655,178,441,255,358],()=>e(e.s=9608)),_N_E=e.O()}]);